# pants.toml
[GLOBAL]
pants_version = "2.27.0"


plugins = ["hdrhistogram"]


backend_packages = [
    "pants.core",
    "pants.backend.python",
    "pants.backend.docker",
    "pants.backend.experimental.terraform",
    "pants.backend.experimental.python.lint.ruff.check",
]


pants_ignore = [
  "templates/**",
]

# Performance and caching
process_execution_local_parallelism = 4
process_execution_cache_namespace = "pants-cache"

[python]
interpreter_constraints = [">=3.12"]

# resolves in 3rdparty
enable_resolves = true
default_resolve = "python"

[python.resolves]
python = "3rdparty/python/python-reqs.lock"
tools = "3rdparty/tools/tools-reqs.lock"


[python-infer]
use_rust_parser = true
# Improve import inference
imports = true
string_imports = true
assets = true


[ruff]
config = "pyproject.toml"

[pytest]
config = "pyproject.toml"
execution_slot_var = "PANTS_EXECUTION_SLOT"
install_from_resolve = "tools"
requirements = ["//3rdparty/tools:tools-reqs#pytest"]

[download-terraform]
version = "1.13.1"
# pants doesn't support versions past 1.9 by default, so we need to add them
known_versions = [
"1.13.1|linux_x86_64|4449e2ddc0dee283f0909dd603eaf98edeebaa950f4635cea94f2caf0ffacc5a|30635389",
"1.13.1|linux_arm64|2bb0787c2da1ad94d6a495a848aad4e9b572adb02bfc7361afeee80f07fd90ac|27815178"
]
extra_env_vars = ["PATH"]
# arch name requiments are inconsistent
platforms = ["linux_amd64", "linux_arm64"] # actions runner has arm64 arch


# Source roots for better organization
[source]
root_patterns = [
    "/",
    "src",
    "tests",
    "packages",
    "services",
    "infra-packages",
    "ditty-bag",
    ".tflint.hcl",
]

# Anonymous telemetry (you can disable if preferred)
[anonymous-telemetry]
enabled = false

# Improved logging
[stats]
log = true
